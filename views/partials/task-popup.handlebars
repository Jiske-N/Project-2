{{!-- {{> task-popup}} --}}

<button id="add-task" data-toggle="modal" data-target="#myModal{{id}}"><i class="fa-solid fa-plus"></i> Add Task</button>
<div
  class="modal fade"
  id="myModal{{id}}"
  tabindex="-1"
  role="dialog"
  aria-labelledby="task-popup"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <p id={{id}} class="list-name">Adding to list: <b>{{name}}</b></p>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="task-title">Task title</label>
          <input class="form-input" type="text" id="task-title-new-{{id}}" />
        </div>
        <div class="form-group">
          <label for="task-description">Description</label>
          <textarea class="form-input" id="task-description-new-{{id}}"></textarea>
        </div>
        <div class="form-group">
          <label for="task-duedate">Due date</label>
          <input class="form-input" type="date" id="task-duedate-new-{{id}}" />
        </div>

        <button id="task-save-{{id}}">Add Task</button>
      </div>
    </div>
  </div>
</div>

<script>
  document
    .querySelector('#task-save-{{id}}')
    .addEventListener('click', async () => {


const title = document.querySelector('#task-title-new-{{id}}').value.trim();
  const description = document.querySelector('#task-description-new-{{id}}').value.trim();
  const dueDate = document.querySelector('#task-duedate-new-{{id}}').value;
  const listId = {{id}}
  
  console.log(listId)

  if (title && description && dueDate, listId) {
    // Send a POST request to the API endpoint
    const response = await fetch('/api/tasks', {
      method: 'POST',
      body: JSON.stringify({ title, description, dueDate, listId }),
      headers: { 'Content-Type': 'application/json' }
    });
  

    if (response.ok) {
      // If successful, redirect the browser to the profile page
      document.location.replace('/board');
    } else {
      alert(`${response.statusText}: Invalid task`);
    }
  }
  document.getElementById('myModal').setAttribute('style', 'display:none'); 
    });



</script>

